<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maternal Health Quiz</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/game.css') }}">
    <!-- <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon"> -->

</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark custom-nav">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('home') }}">Welcome, SalomeMonthe</a>
      <ul class="navbar-nav">
        
        <li class="nav-item">
            <a href="{{ url_for('game') }}" class="btn btn-outline-light me-2">Back</a> 
        </li>
        <li class="nav-item">
            <a href="{{ url_for('home') }}" class="btn btn-outline-light me-2">Logout</a> 
        </li>
        
    </ul>
    </div>
  </nav>

  <div class="progress mt-4">
    <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
  </div>
  

    <div id="quizCard" class="card shadow">
      <div class="avatar-container">
        <img id="avatar" src="static/images/woman1/avatar3-happy.png" alt="Avatar" class="avatar-img">
      </div>
      <h5 id="scenario" class="card-title">Loading...</h5>
      <div id="options" class="options"></div>
      <p id="feedback" class="mt-3 feedback-text"></p>
      <p id="reasoning" class="mt-2"></p>
      <button id="askFunza" class="btn btn-ask mt-2">Ask Funza</button>
    </div>
    <div class="mt-3">
      <button id="retryBtn" class="btn btn-warning d-none" onclick="retryQuiz()">Try Again</button>
      <button id="completeBtn" class="btn btn-success d-none" onclick="completeQuiz()">Complete</button>
    </div>
  </div>


  <script>
    const scenarios = [
      {
        question: "What is the recommended number of antenatal care visits?",
        options: ["4", "6", "8"],
        answer: "8",
        correctReason: "Eight visits ensure proper monitoring and early detection of complications.",
        incorrectReason: "Fewer than 8 visits may miss important health checks."
      },
      {
        question: "Which nutrient is crucial for fetal brain development?",
        options: ["Iron", "Folic Acid", "Calcium"],
        answer: "Folic Acid",
        correctReason: "Folic acid prevents neural tube defects in the baby.",
        incorrectReason: "Other nutrients are important, but folic acid is specifically for brain development."
      },
      {
        question: "What is the safest sleeping position for a pregnant woman?",
        options: ["On the back", "On the left side", "On the right side"],
        answer: "On the left side",
        correctReason: "Sleeping on the left side improves blood flow to the baby.",
        incorrectReason: "Other positions can reduce circulation and increase complications."
      },
      {
        question: "What should pregnant women avoid consuming in large amounts?",
        options: ["Caffeine", "Fruits", "Vegetables"],
        answer: "Caffeine",
        correctReason: "High caffeine intake can lead to low birth weight and other issues.",
        incorrectReason: "Fruits and vegetables are beneficial, but caffeine should be limited."
      }
    ];
  
    let currentIndex = 0;
    let correctAnswers = 0;
    let attempts = 0;
  
    function updateProgressBar() {
      let progressBar = document.getElementById("progressBar");
      if (progressBar) {
        let progress = (currentIndex / scenarios.length) * 100;
        progressBar.style.width = progress + "%";
      }
    }
  
    function loadScenario() {
      if (currentIndex >= scenarios.length) {
        displayCompletionMessage();
        return;
      }
  
      let scenarioElement = document.getElementById("scenario");
      let optionsElement = document.getElementById("options");
      let feedbackElement = document.getElementById("feedback");
      let reasoningElement = document.getElementById("reasoning");
  
      if (!scenarioElement || !optionsElement || !feedbackElement || !reasoningElement) {
        console.error("Error: One or more required elements are missing from the DOM.");
        return;
      }
  
      let scenario = scenarios[currentIndex];
      scenarioElement.textContent = scenario.question;
      optionsElement.innerHTML = "";
      feedbackElement.textContent = "";
      reasoningElement.textContent = "";
  
      scenario.options.forEach(option => {
        let button = document.createElement("button");
        button.textContent = option;
        button.className = "btn btn-primary";
        button.onclick = () => checkAnswer(option);
        optionsElement.appendChild(button);
      });
  
      updateProgressBar();
    }
  
    function checkAnswer(selected) {
      let scenario = scenarios[currentIndex];
      let feedback = document.getElementById("feedback");
      let reasoning = document.getElementById("reasoning");
      let avatar = document.getElementById("avatar");
  
      if (!feedback || !reasoning || !avatar) {
        console.error("Error: Missing elements in checkAnswer function.");
        return;
      }
  
      if (selected === scenario.answer) {
        feedback.textContent = "✅ Correct!";
        feedback.className = "text-success";
        reasoning.textContent = scenario.correctReason;
        avatar.src = "static/images/woman1/avatar3-happy.png";
        correctAnswers++;
        setTimeout(() => {
          currentIndex++;
          attempts = 0;
          loadScenario();
        }, 2000);
      } else {
        attempts++;
        feedback.textContent = "❌ Wrong answer. Try again.";
        feedback.className = "text-danger";
        reasoning.textContent = scenario.incorrectReason;
        avatar.src = attempts === 1 ? "static/images/woman1/avatar1-sad.png" : "static/images/woman1/avatar4-grumpy.png";
        setTimeout(() => {
          currentIndex++;
          attempts = 0;
          loadScenario();
        }, 2000);
      }

    }
  
    function displayCompletionMessage() {
    let quizCard = document.getElementById("quizCard");
    let retryBtn = document.getElementById("retryBtn");
    let completeBtn = document.getElementById("completeBtn");

    if (!quizCard || !retryBtn || !completeBtn) {
        console.error("Error: quizCard, retryBtn, or completeBtn element not found.");
        return;
    }

    let scoreMessage = `Your Score: <strong>${correctAnswers} / ${scenarios.length}</strong>`;
    
    if (correctAnswers === scenarios.length) {
        quizCard.innerHTML = `<h3>Hurray! 🎉 You got everything correct!</h3><p>${scoreMessage}</p>`;
    } else {
        quizCard.innerHTML = `<h3>Quiz Completed!</h3><p>${scoreMessage}</p><p>Don't worry, you can try again to improve your score!</p>`;
    }

    // Show retry and complete buttons
    retryBtn.classList.remove("d-none");
    completeBtn.classList.remove("d-none");

    updateProgressBar();
}

  
function retryQuiz() {
    currentIndex = 0;
    correctAnswers = 0;
    attempts = 0;

    location.reload();
}

  
    function completeQuiz() {
      alert("You can still attempt this stage to get different questions!");
      window.location.href = "{{ url_for('game') }}";
    }
  
    document.addEventListener("DOMContentLoaded", function () {
      let retryButton = document.getElementById("retryButton");
      if (retryButton) {
        retryButton.addEventListener("click", retryQuiz);
      }
  
      loadScenario();
    });
  </script>
  
</body>
</html>
